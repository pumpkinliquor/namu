<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdminBBSArticle">
	
 	<select id="selectMaxNttId" resultType="java.lang.Long">
		SELECT IFNULL(MAX(NTT_ID),0)+1 AS NTT_ID  FROM COMTNBBS
 	</select>
 	
	<insert id="insertArticle" parameterType="adminBoardVO">
		<selectKey keyProperty="nttNo" resultType="java.lang.Long" order="BEFORE">
			SELECT IFNULL(MAX(SORT_ORDR),0)+1 AS NTT_NO  FROM COMTNBBS
			WHERE BBS_ID = #{bbsId}
		</selectKey>
		INSERT INTO COMTNBBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
			 NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
			 PARNTSCTT_NO, NTT_NO, ANSWER_LC, ATCH_FILE_ID,
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT,
			 SJ_BOLD_AT, NOTICE_AT, SECRET_AT, BLOG_ID, POSTING_YN
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, CUSTOM1
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
				, CUSTOM2
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
				, CUSTOM3
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
				, CUSTOM4
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom5)">
				, CUSTOM5
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
				, CUSTOM_DATE1
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
				, CUSTOM_DATE2
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate3)">
				, CUSTOM_DATE3
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate4)">
				, CUSTOM_DATE4
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate5)">
				, CUSTOM_DATE5
			</if>
			)
		VALUES
		(
			#{nttId}, #{bbsId}, #{nttSj}, #{nttCn}, #{nttId}, 
			#{ntcrId}, #{ntcrNm}, #{password}, 0, 
			#{ntceBgnde}, #{ntceEndde}, #{replyAt}, 
			#{parnts}, 1, #{replyLc}, #{atchFileId},
			#{frstRegisterId}, SYSDATE(), 'Y',
			#{sjBoldAt}, #{noticeAt}, #{secretAt}, #{blogId}, #{postingYn}
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, #{custom1}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
				, #{custom2}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
				, #{custom3}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
				, #{custom4}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom5)">
				, #{custom5}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
				, CONCAT(#{customDate1}, ' 00:00:00')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
				, CONCAT(#{customDate2}, ' 00:00:00')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate3)">
				, CONCAT(#{customDate3}, ' 00:00:00')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate4)">
				, CONCAT(#{customDate4}, ' 00:00:00')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate5)">
				, CONCAT(#{customDate5}, ' 00:00:00')
			</if>
			)
	</insert>
	
	<insert id="replyArticle" parameterType="adminBoardVO">
		<selectKey keyProperty="nttNo" resultType="java.lang.Long" order="BEFORE">
			SELECT IFNULL(MAX(NTT_NO),0)+1 AS NTT_NO  FROM COMTNBBS
			WHERE BBS_ID = #{bbsId} AND SORT_ORDR = #{sortOrdr}
		</selectKey>
		INSERT INTO COMTNBBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
			 NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
			 PARNTSCTT_NO, NTT_NO, ANSWER_LC, ATCH_FILE_ID,
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT,
			 SJ_BOLD_AT, NOTICE_AT, SECRET_AT
			 )
		VALUES
			( #{nttId}, #{bbsId}, #{nttSj}, #{nttCn}, #{sortOrdr}, 
			  #{ntcrId}, #{ntcrNm}, #{password}, #{inqireCo}, 
			  #{ntceBgnde}, #{ntceEndde}, #{replyAt}, 
			  #{parnts}, #{nttNo}, #{replyLc}, #{atchFileId},
			  #{frstRegisterId}, SYSDATE(), 'Y',
			  #{sjBoldAt}, #{noticeAt}, #{secretAt}
			 )
	</insert>
	
	<select id="selectArticleList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.RDCNT AS inqireCo
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.SJ_BOLD_AT AS sjBoldAt
			, IFNULL(a.NOTICE_AT, 'N') AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT COUNT(*) FROM COMTNBBS
				WHERE PARNTSCTT_NO = a.NTT_ID
			) AS appCnt 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
					AND ((CAST(a.CUSTOM_DATE1 AS DATE) BETWEEN #{customDate1} AND CAST(a.CUSTOM_DATE2 AS DATE)) OR (#{customDate1} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
					AND ((CAST(a.CUSTOM_DATE2 AS DATE) BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND #{customDate2}) OR (#{customDate2} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
			</when>
			<otherwise>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectArticleListCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(a.NTT_ID)
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		WHERE a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>	
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
					AND ((CAST(a.CUSTOM_DATE1 AS DATE) BETWEEN #{customDate1} AND CAST(a.CUSTOM_DATE2 AS DATE)) OR (#{customDate1} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
					AND ((CAST(a.CUSTOM_DATE2 AS DATE) BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND #{customDate2}) OR (#{customDate2} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
			</when>
			<otherwise>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
	</select>
	
	<select id="selectArticleListExcel" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.RDCNT AS inqireCo
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.SJ_BOLD_AT AS sjBoldAt
			, IFNULL(a.NOTICE_AT, 'N') AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT COUNT(*) FROM COMTNBBS
				WHERE PARNTSCTT_NO = a.NTT_ID
			) AS appCnt 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND a.CUSTOM_DATE1 <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND a.CUSTOM_DATE1 <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
					AND a.CUSTOM_DATE1 <![CDATA[ >= ]]> #{customDate1}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
					AND a.CUSTOM_DATE1 <![CDATA[ <= ]]> #{customDate2}
				</if>
			</when>
			<otherwise>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND a.FRST_REGIST_PNTTM <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND a.FRST_REGIST_PNTTM <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
	</select>
	
	<select id="selectArticleDetail" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, a.PASSWORD AS password
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.RDCNT AS inqireCo
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTT_ID AS nttId
			, a.SJ_BOLD_AT AS sjBoldAt
			, a.NOTICE_AT AS noticeAt
			, a.SECRET_AT AS secretAt
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, a.SORT_ORDR AS sortOrdr
			, c.BBS_TY_CODE AS bbsTyCode
			, c.REPLY_POSBL_AT AS replyPosblAt
			, c.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, c.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, c.BBS_NM AS bbsNm
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, CUSTOM1 AS custom1
			, CUSTOM2 AS custom2
			, CUSTOM3 AS custom3
			, CUSTOM4 AS custom4
			, CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT GROUP_CONCAT(TAG_NM SEPARATOR ',') FROM COMTNBBSTAG WHERE NTT_ID = a.NTT_ID
			) AS tagNmList
			, (
				SELECT COUNT(*) FROM COMTNBBS
				WHERE PARNTSCTT_NO = a.NTT_ID
			) AS appCnt 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN 
			COMTNBBSMASTER c
		ON a.BBS_ID = c.BBS_ID			
		WHERE
			a.BBS_ID = #{bbsId}	
			AND
				a.NTT_ID = #{nttId}	
	</select>
	
	<select id="selectArticleDetailCn" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, a.PASSWORD AS password
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.RDCNT AS inqireCo
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTT_ID AS nttId
			, a.SJ_BOLD_AT AS sjBoldAt
			, a.NOTICE_AT AS noticeAt
			, a.SECRET_AT AS secretAt
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, a.SORT_ORDR AS sortOrdr
			, c.BBS_TY_CODE AS bbsTyCode
			, c.REPLY_POSBL_AT AS replyPosblAt
			, c.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, c.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, c.BBS_NM AS bbsNm
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, CUSTOM1 AS custom1
			, CUSTOM2 AS custom2
			, CUSTOM3 AS custom3
			, CUSTOM4 AS custom4
			, CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT GROUP_CONCAT(TAG_NM SEPARATOR ',') FROM COMTNBBSTAG WHERE NTT_ID = a.NTT_ID
			) AS tagNmList 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN 
			COMTNBBSMASTER c
		ON a.BBS_ID = c.BBS_ID			
		WHERE
			a.BBS_ID = #{bbsId}	
			AND
				a.NTT_ID = #{nttId}
	</select>
	
 	<update id="updateArticle" parameterType="adminBoardVO">
		UPDATE COMTNBBS SET 
			NTT_SJ = #{nttSj}
			, NTT_CN = #{nttCn} 
			, NTCE_BGNDE = #{ntceBgnde}		
			, NTCE_ENDDE = #{ntceEndde}
			, LAST_UPDUSR_ID = #{lastUpdusrId}
			, ATCH_FILE_ID = #{atchFileId}
			, LAST_UPDT_PNTTM = SYSDATE()
			, SJ_BOLD_AT = #{sjBoldAt}
			, NOTICE_AT = #{noticeAt}
			, SECRET_AT = #{secretAt}
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			, POSTING_YN = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			, CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			, CUSTOM2 = #{custom2}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
			, CUSTOM3 = #{custom3}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
			, CUSTOM4 = #{custom4}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom5)">
			, CUSTOM5 = #{custom5}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
			, CUSTOM_DATE1 = CONCAT(#{customDate1}, ' 00:00:00')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
			, CUSTOM_DATE2 = CONCAT(#{customDate2}, ' 00:00:00')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate3)">
			, CUSTOM_DATE3 = CONCAT(#{customDate3}, ' 00:00:00')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate4)">
			, CUSTOM_DATE4 = CONCAT(#{customDate4}, ' 00:00:00')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate5)">
			, CUSTOM_DATE5 = CONCAT(#{customDate5}, ' 00:00:00')
		</if>
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<update id="deleteArticle" parameterType="adminBoardVO">
 		UPDATE COMTNBBS SET 
			USE_AT = 'N',
			LAST_UPDUSR_ID = #{lastUpdusrId},
			LAST_UPDT_PNTTM = SYSDATE()
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<select id="selectMaxInqireCo" parameterType="adminBoardVO" resultType="java.lang.Integer">
 		SELECT IFNULL(MAX(RDCNT),0)+1 AS RDCNT FROM COMTNBBS
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</select>
 	
 	<update id="updateInqireCo" parameterType="adminBoardVO">
 		UPDATE COMTNBBS SET 
			RDCNT = #{inqireCo},
			LAST_UPDUSR_ID = #{lastUpdusrId},
			LAST_UPDT_PNTTM = SYSDATE()
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<select id="selectNoticeArticleList" parameterType="adminBoardVO" resultType="adminBoardVO">
 		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.RDCNT AS inqireCo
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.SJ_BOLD_AT AS sjBoldAt
			, IFNULL(a.NOTICE_AT, 'N') AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, CUSTOM1 AS custom1
			, CUSTOM2 AS custom2
			, CUSTOM3 AS custom3
			, CUSTOM4 AS custom4
			, CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON a.NTT_ID = c.NTT_ID
		AND a.BBS_ID = c.BBS_ID
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.NOTICE_AT = 'Y'
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
		LIMIT 5		
	</select>
	
	<select id="selectGuestArticleList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S')	AS frstRegisterPnttm
			, a.NTT_CN AS nttCn
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.BBS_ID AS bbsId
			, b.USER_NM AS frstRegisterNm
			, a.FRST_REGISTER_ID AS frstRegisterId
		FROM
			COMTNBBS a, COMVNUSERMASTER b
		WHERE
			a.BBS_ID = #{bbsId}
			AND 
				a.FRST_REGISTER_ID = b.ESNTL_ID
			AND
				a.USE_AT = 'Y'
		ORDER BY a.SORT_ORDR DESC, a.NTT_NO ASC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectGuestArticleListCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(NTT_ID)
		FROM
			COMTNBBS 
		WHERE
			BBS_ID = #{bbsId}	
		AND
			USE_AT = 'Y'
	</select>
	
	<select id="selectLoginUser" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(FRST_REGISTER_ID)
		FROM
			COMTNBLOG 
		WHERE
			FRST_REGISTER_ID = #{frstRegisterId}
			AND
				BLOG_ID = #{blogId}
	</select>
	
	<select id="selectBlogListManager" parameterType="adminBoardVO" resultType="adminBoardMasterVO">
		SELECT 
			A.BBS_ID AS bbsId
			, A.BLOG_ID AS blogId
			, A.BBS_NM AS bbsNm
			, C.USER_NM AS frstRegisterNm
			, DATE_FORMAT(A.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, IFNULL(A.USE_AT, 'N') AS useAt
		FROM
 			COMTNBBSMASTER A
		LEFT OUTER JOIN    
			COMTNBLOG B
		ON A.BLOG_ID = B.BLOG_ID
		LEFT OUTER JOIN
		  (SELECT ESNTL_ID, USER_ID, USER_NM FROM COMVNUSERMASTER) C
		ON A.FRST_REGISTER_ID = C.ESNTL_ID
		WHERE A.BLOG_ID = #{blogId}
			<if test="searchCnd == 0">AND
					A.BBS_NM LIKE CONCAT ('%', #{searchWrd},'%') 		
			</if>
			<if test="searchCnd == 1">AND
					A.BBS_INTRCN LIKE CONCAT ('%', #{searchWrd},'%') 		
			</if> 
	 	ORDER BY A.FRST_REGIST_PNTTM DESC
	</select>
	
	<select id="selectBlogListManagerCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT 
			COUNT(1) 
		FROM
 			COMTNBBSMASTER A, COMTNBLOG B
 		WHERE A.BLOG_ID = B.BLOG_ID
	 		AND B.BLOG_ID = #{blogId}
	 		<if test="searchCnd == 0">
	 			AND
					A.BBS_NM LIKE CONCAT ('%', #{searchWrd},'%') 		
			</if>
			<if test="searchCnd == 1">
				AND
					A.BBS_INTRCN LIKE CONCAT ('%', #{searchWrd},'%') 		
			</if>
	 	ORDER BY A.FRST_REGIST_PNTTM DESC
	</select>
	
	<select id="selectArticleCnOne" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_CN AS nttCn
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN 
			COMTNBBSMASTER c
		ON a.BBS_ID = c.BBS_ID			
		WHERE
			a.BBS_ID = #{bbsId}	
			AND 
				a.USE_AT = 'Y'
		ORDER BY a.SORT_ORDR DESC
		LIMIT 1		
	</select>
	
	<select id="selectBlogNmList" parameterType="adminBoardVO" resultType="adminBoardMasterVO">
		SELECT  
			A.BBS_ID AS bbsId
			, A.BLOG_ID AS blogId
			, A.BBS_NM AS bbsNm
		FROM
 			COMTNBBSMASTER A, COMTNBLOG B
 		WHERE A.BLOG_ID = B.BLOG_ID
	 		AND B.BLOG_ID = #{blogId}
 		ORDER BY A.FRST_REGIST_PNTTM DESC
 		LIMIT 7 OFFSET 0
	</select>
	
	<select id="selectArticleDetailDefault" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, a.PASSWORD AS password
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(a.NTCR_NM, '') AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.RDCNT AS inqireCo
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTT_ID AS nttId
			, a.SJ_BOLD_AT AS sjBoldAt
			, a.NOTICE_AT AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, d.REPLY_POSBL_AT AS replyPosblAt
			, d.BLOG_ID AS BLOG_ID
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, a.SORT_ORDR AS sortOrdr
			, c.BBS_TY_CODE AS bbsTyCode
			, c.REPLY_POSBL_AT AS replyPosblAt
			, c.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, c.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, c.BBS_NM AS bbsNm
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT GROUP_CONCAT(TAG_NM SEPARATOR ',') FROM COMTNBBSTAG WHERE NTT_ID = a.NTT_ID
			) AS tagNmList 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON a.NTT_ID = c.NTT_ID
		LEFT OUTER JOIN
			COMTNBBSMASTER d
		ON a.BBS_ID = d.BBS_ID
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		ORDER BY a.SORT_ORDR DESC, NTT_NO ASC
		<if test="searchCnd == 5">
			LIMIT 5 		
		</if>
		<if test="searchCnd == 10">
			LIMIT 10 		
		</if>
		<if test="searchCnd == 15">
			LIMIT 15 		
		</if>
		<if test="searchCnd == 20">
			LIMIT 20 		
		</if>
		<if test="searchCnd == 30">
			LIMIT 30 		
		</if>			
	</select>
	
	<select id="selectArticleDetailDefaultCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(*)
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON a.NTT_ID = c.NTT_ID
		LEFT OUTER JOIN
			COMTNBBSMASTER d
		ON a.BBS_ID = d.BBS_ID
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		ORDER BY a.SORT_ORDR DESC, NTT_NO ASC
	</select>
	
	<!-- 나무병원 추가  -->
	<delete id="deleteTagNm" parameterType="adminBoardVO" >
		DELETE FROM COMTNBBSTAG
		WHERE NTT_ID = #{nttId}
	</delete>
	
	<insert id="insertTagNm" parameterType="adminBoardVO" >
		INSERT INTO COMTNBBSTAG
		(
			TAG_NM
			, NTT_ID
		)
		VALUES
		(
			#{tagNm}
			, #{nttId}
		)
	</insert>
	
	<select id="selectJACList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, d.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(a.NTCR_NM, '') AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, d.RDCNT AS inqireCo
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.SJ_BOLD_AT AS sjBoldAt
			, IFNULL(a.NOTICE_AT, 'N') AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, d.CUSTOM1 AS parntsCustom1
			, d.CUSTOM2 AS parntsCustom2
			, d.CUSTOM3 AS parntsCustom3
			, d.CUSTOM4 AS parntsCustom4
			, d.CUSTOM5 AS parntsCustom5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		LEFT OUTER JOIN
			COMTNBBS d
		ON (a.PARNTSCTT_NO = d.NTT_ID)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				d.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(frstRegisterNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{frstRegisterNm},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
			AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
			AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
			AND a.CUSTOM4 LIKE CONCAT ('%', #{custom4},'%')
		</if>
		ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectJACListCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(a.ntt_id)
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		LEFT OUTER JOIN
			COMTNBBS d
		ON (a.PARNTSCTT_NO = d.NTT_ID)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				d.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(frstRegisterNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{frstRegisterNm},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
			AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
			AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
			AND a.CUSTOM4 LIKE CONCAT ('%', #{custom4},'%')
		</if>
	</select>
	
	<select id="selectJACDetail" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, d.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, a.PASSWORD AS password
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, d.RDCNT AS inqireCo
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.SJ_BOLD_AT AS sjBoldAt
			, a.NOTICE_AT AS noticeAt
			, a.SECRET_AT AS secretAt
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, a.SORT_ORDR AS sortOrdr
			, c.BBS_TY_CODE AS bbsTyCode
			, c.REPLY_POSBL_AT AS replyPosblAt
			, c.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, c.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, c.BBS_NM AS bbsNm
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, d.CUSTOM1 AS parntsCustom1
			, d.CUSTOM2 AS parntsCustom2
			, d.CUSTOM3 AS parntsCustom3
			, d.CUSTOM4 AS parntsCustom4
			, d.CUSTOM5 AS parntsCustom5
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE1, '%Y.%m.%d'), '') AS parntsCustomDate1
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE2, '%Y.%m.%d'), '') AS parntsCustomDate2
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE3, '%Y.%m.%d'), '') AS parntsCustomDate3
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE4, '%Y.%m.%d'), '') AS parntsCustomDate4
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE5, '%Y.%m.%d'), '') AS parntsCustomDate5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN 
			COMTNBBSMASTER c
		ON a.BBS_ID = c.BBS_ID
		LEFT OUTER JOIN
			COMTNBBS d
		ON a.PARNTSCTT_NO = d.NTT_ID
		WHERE
			a.BBS_ID = #{bbsId}	
			AND
				a.NTT_ID = #{nttId}	
	</select>
	
	<select id="searchJACInfo" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, d.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, a.PASSWORD AS password
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, d.RDCNT AS inqireCo
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.SJ_BOLD_AT AS sjBoldAt
			, a.NOTICE_AT AS noticeAt
			, a.SECRET_AT AS secretAt
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, a.SORT_ORDR AS sortOrdr
			, c.BBS_TY_CODE AS bbsTyCode
			, c.REPLY_POSBL_AT AS replyPosblAt
			, c.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, c.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, c.BBS_NM AS bbsNm
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, d.CUSTOM1 AS parntsCustom1
			, d.CUSTOM2 AS parntsCustom2
			, d.CUSTOM3 AS parntsCustom3
			, d.CUSTOM4 AS parntsCustom4
			, d.CUSTOM5 AS parntsCustom5
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE1, '%Y.%m.%d'), '') AS parntsCustomDate1
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE2, '%Y.%m.%d'), '') AS parntsCustomDate2
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE3, '%Y.%m.%d'), '') AS parntsCustomDate3
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE4, '%Y.%m.%d'), '') AS parntsCustomDate4
			, IFNULL(DATE_FORMAT(d.CUSTOM_DATE5, '%Y.%m.%d'), '') AS parntsCustomDate5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN 
			COMTNBBSMASTER c
		ON a.BBS_ID = c.BBS_ID
		LEFT OUTER JOIN
			COMTNBBS d
		ON a.PARNTSCTT_NO = d.NTT_ID
		WHERE
			a.BBS_ID = #{bbsId}	
			AND a.NTCR_NM = #{ntcrNm}
			AND a.PASSWORD = #{password}
			AND IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y%m%d'), '') = #{customDate1}
		ORDER BY a.NTT_ID DESC
		LIMIT 1
	</select>
	
	<select id="selectArticleCurRownum" parameterType="adminBoardVO" resultType="int">
		SELECT rnum FROM (
			SELECT
				a.NTT_ID AS nttId,
		 		<![CDATA[ @rownum := @rownum+1 ]]> AS RNUM 
			FROM
				COMTNBBS a
			LEFT OUTER JOIN 
				COMVNUSERMASTER b
			ON a.FRST_REGISTER_ID = b.ESNTL_ID 
			LEFT OUTER JOIN
				(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
				   FROM COMTNCOMMENT 
				 WHERE USE_AT = 'Y' 
				 GROUP BY NTT_ID, BBS_ID) c
			ON (a.NTT_ID = c.NTT_ID
				AND a.BBS_ID = c.BBS_ID
			), (SELECT <![CDATA[ @rownum := 0 ]]>) AS R
			WHERE
				a.BBS_ID = #{bbsId}
				AND a.USE_AT = 'Y'
			<if test="searchCnd == 0">
				AND
					a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
			</if>
			<if test="searchCnd == 1">
				AND
					a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
			</if>
			<if test="searchCnd == 2">
				AND
					b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
				AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
				AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
			</if>
			<choose>
				<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
						AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
					</if>
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
						AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
					</if>
				</when>
				<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
						AND ((CAST(a.CUSTOM_DATE1 AS DATE) BETWEEN #{customDate1} AND CAST(a.CUSTOM_DATE2 AS DATE)) OR (#{customDate1} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
					</if>
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
						AND ((CAST(a.CUSTOM_DATE2 AS DATE) BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND #{customDate2}) OR (#{customDate2} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
					</if>
				</when>
				<otherwise>
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
						AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
					</if>
					<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
						AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
					</if>
				</otherwise>
			</choose>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				AND a.CUSTOM1 = #{custom1}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
				AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
				AND a.PARNTSCTT_NO = 0
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
				AND a.NTT_ID in (
					SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
				)
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
				AND a.NTT_ID not in (
					SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
				)
			</if>
			<choose>
				<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
					ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
				</when>
				<otherwise>
					ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
				</otherwise>
			</choose>
		) T
		WHERE nttId = #{nttId}
	</select>
	
	<select id="selectArticlePre" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
					AND ((CAST(a.CUSTOM_DATE1 AS DATE) BETWEEN #{customDate1} AND CAST(a.CUSTOM_DATE2 AS DATE)) OR (#{customDate1} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
					AND ((CAST(a.CUSTOM_DATE2 AS DATE) BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND #{customDate2}) OR (#{customDate2} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
			</when>
			<otherwise>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
		LIMIT #{recordCountPerPage}, 1
	</select>
	
	<select id="selectArticleNext" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.CUSTOM_DATE1 AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000009')">
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate1)">
					AND ((CAST(a.CUSTOM_DATE1 AS DATE) BETWEEN #{customDate1} AND CAST(a.CUSTOM_DATE2 AS DATE)) OR (#{customDate1} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(customDate2)">
					AND ((CAST(a.CUSTOM_DATE2 AS DATE) BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND #{customDate2}) OR (#{customDate2} BETWEEN CAST(a.CUSTOM_DATE1 AS DATE) AND CAST(a.CUSTOM_DATE2 AS DATE)))
				</if>
			</when>
			<otherwise>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchBgnDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ >= ]]> #{searchBgnDe}
				</if>
				<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchEndDe)">
					AND CAST(a.FRST_REGIST_PNTTM AS DATE) <![CDATA[ <= ]]> #{searchEndDe}
				</if>
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
		LIMIT #{recordCountPerPage}, 1
	</select>
	
	<select id="selectArticleReply" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NOTICE_AT AS noticeAt
			, a.SORT_ORDR AS sortOrdr 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
		FROM
			COMTNBBS a, COMTNBBS b
		WHERE a.BBS_ID = b.BBS_ID
			AND a.PARNTSCTT_NO = b.NTT_ID
			AND a.BBS_ID = #{bbsId}
			AND b.NTT_ID = #{nttId}
		ORDER BY a.FRST_REGIST_PNTTM DESC
		LIMIT 1
	</select>
	
	<select id="selectMiniboardList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NOTICE_AT AS noticeAt
			, a.SORT_ORDR AS sortOrdr 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE 
			a.BBS_ID = #{bbsId}	
			AND a.USE_AT = 'Y'
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(recordCountPerPage)">
		LIMIT #{recordCountPerPage}
		</if>
	</select>
	
	<select id="selectMiniboardMainManageList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTCR_ID AS ntcrId
			, a.NTCR_NM AS ntcrNm
			, a.NTT_NO AS nttNo
			, a.NTT_CN AS nttCn
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.ATCH_FILE_ID AS atchFileId
			, (SELECT f.FILE_SN FROM COMTNFILEDETAIL f WHERE f.ATCH_FILE_ID = atchFileId ORDER BY f.FILE_SN ASC LIMIT 1) AS atchFileSn
			, (SELECT f.FILE_EXTSN FROM COMTNFILEDETAIL f WHERE f.ATCH_FILE_ID = atchFileId ORDER BY f.FILE_SN ASC LIMIT 1) AS atchFileExtsn
			, (SELECT f.ORIGNL_FILE_NM FROM COMTNFILEDETAIL f WHERE f.ATCH_FILE_ID = atchFileId ORDER BY f.FILE_SN ASC LIMIT 1) AS atchFileNm
			, a.BBS_ID AS bbsId
			, a.NOTICE_AT AS noticeAt
			, a.SORT_ORDR AS sortOrdr 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE 
			a.BBS_ID = #{bbsId}	
			AND a.USE_AT = 'Y'
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<choose>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000001')">
				ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<when test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000002')">
				ORDER BY a.CUSTOM_DATE1 DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
			</when>
			<otherwise>
				ORDER BY a.SORT_ORDR ASC, a.NTT_NO ASC
			</otherwise>
		</choose>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(recordCountPerPage)">
		LIMIT #{recordCountPerPage}
		</if>
	</select>
	
	<select id="selectSPCList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			IFNULL(b.NTT_ID, 0) AS nttId
			, c.CODE_ID_NM AS nttSj
			, DATE_FORMAT(IFNULL(b.LAST_UPDT_PNTTM, b.FRST_REGIST_PNTTM), '%Y.%m.%d') AS frstRegisterPnttm
			, c.CODE_ID as custom1
		FROM
			COMTNBBS b
		RIGHT OUTER JOIN
			(SELECT 
				CODE_ID
				, CODE_ID_NM
				, CODE_ID_DC
			FROM COMTCCMMNCODE
			WHERE USE_AT = 'Y'
				AND CL_CODE = #{parntsCustom1}
			) c
		ON (b.CUSTOM1 = c.CODE_ID
			AND b.BBS_ID = #{bbsId}	
			AND b.USE_AT = 'Y'
		)
		ORDER BY c.CODE_ID ASC
	</select>
	
	<select id="selectSPCDetail" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			c.CODE_ID_NM AS nttSj
			, b.NTCR_ID AS ntcrId
			, b.NTCR_NM AS ntcrNm
			, IFNULL(b.NTT_NO, 0) AS nttNo
			, b.NTT_CN AS nttCn
			, DATE_FORMAT(b.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, DATE_FORMAT(b.LAST_UPDT_PNTTM, '%Y.%m.%d %H:%i:%S') AS lastUpdusrPnttm
			, b.RDCNT AS inqireCo
			, b.ATCH_FILE_ID AS atchFileId
			, b.BBS_ID AS bbsId
			, IFNULL(b.NTT_ID, 0) AS nttId
			, s.BBS_TY_CODE AS bbsTyCode
			, s.REPLY_POSBL_AT AS replyPosblAt
			, s.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, s.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, s.BBS_NM AS bbsNm 
			, c.CODE_ID AS custom1
			, CUSTOM2 AS custom2
			, CUSTOM3 AS custom3
			, CUSTOM4 AS custom4
			, CUSTOM5 AS custom5
			, (
				SELECT GROUP_CONCAT(TAG_NM SEPARATOR ',') FROM COMTNBBSTAG WHERE NTT_ID = b.NTT_ID
			) AS tagNmList 
		FROM
			COMTNBBS b
		LEFT OUTER JOIN 
			COMTNBBSMASTER s
		ON b.BBS_ID = s.BBS_ID		
		RIGHT OUTER JOIN
			(SELECT 
				CODE_ID
				, CODE_ID_NM
				, CODE_ID_DC
			FROM COMTCCMMNCODE
			WHERE USE_AT = 'Y'
				AND CL_CODE = #{parntsCustom1}
				AND CODE_ID = #{custom1}
			) c
		ON (b.CUSTOM1 = c.CODE_ID
			AND b.BBS_ID = #{bbsId}	
			AND b.USE_AT = 'Y'
		)
	</select>
 	
	<insert id="insertSPC" parameterType="adminBoardVO">
		<selectKey keyProperty="parnts" resultType="String" order="BEFORE">
			SELECT IFNULL(NTT_ID, 1) AS parnts  FROM COMTNBBS
			WHERE BBS_ID = #{bbsId}
				AND CUSTOM1 = #{parntsCustom1}
		</selectKey>
		INSERT INTO COMTNBBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, RDCNT,  			   
			 PARNTSCTT_NO, NTT_NO, ATCH_FILE_ID,
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, CUSTOM1
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
				, CUSTOM2
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
				, CUSTOM3
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
				, CUSTOM4
			</if>
			)
		VALUES
		(
			#{nttId}, #{bbsId}, #{nttSj}, #{nttCn}, #{nttId}, 
			#{ntcrId}, #{ntcrNm}, 0, 
			#{parnts}, #{nttNo}, #{atchFileId},
			#{frstRegisterId}, SYSDATE(), #{useAt}
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, #{custom1}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
				, #{custom2}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
				, #{custom3}
			</if>
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
				, #{custom4}
			</if>
			)
	</insert>
	
	<select id="selectSPCChildList" parameterType="adminBoardVO" resultType="adminBoardVO">
	   SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.NTT_NO AS nttNo
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(a.NTCR_NM, '') AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.LAST_UPDUSR_ID AS lastUpdusrId
			, DATE_FORMAT(a.LAST_UPDT_PNTTM, '%Y.%m.%d') AS lastUpdusrPnttm
			, a.PARNTSCTT_NO AS parnts
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, c.FILE_EXTSN AS fileEx
			, a.BBS_ID AS bbsId
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
		 FROM
			  COMTNBBS a
		 LEFT JOIN COMTNFILEDETAIL c
		   ON c.ATCH_FILE_ID = a.ATCH_FILE_ID 
		WHERE
			  a.BBS_ID = #{bbsId}
			  AND a.PARNTSCTT_NO = (
			  SELECT NTT_ID FROM COMTNBBS WHERE BBS_ID = #{bbsId}
			     AND CUSTOM1 = #{parntsCustom1}
			)
		ORDER BY a.ntt_no ASC
	</select>
	
 	<update id="updateSPC" parameterType="adminBoardVO">
		UPDATE COMTNBBS SET 
			NTT_SJ = #{nttSj}
			, NTT_CN = #{nttCn} 
			, LAST_UPDUSR_ID = #{lastUpdusrId}
			, ATCH_FILE_ID = #{atchFileId}
			, LAST_UPDT_PNTTM = SYSDATE()
			, USE_AT = #{useAt}
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			, CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			, CUSTOM2 = #{custom2}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom3)">
			, CUSTOM3 = #{custom3}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom4)">
			, CUSTOM4 = #{custom4}
		</if>
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
	
	<select id="selectTRMDetail" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			b.NTT_SJ AS nttSj
			, b.NTCR_ID AS ntcrId
			, b.NTCR_NM AS ntcrNm
			, IFNULL(b.NTT_NO, 0) AS nttNo
			, b.NTT_CN AS nttCn
			, DATE_FORMAT(b.FRST_REGIST_PNTTM, '%Y.%m.%d %H:%i:%S') AS frstRegisterPnttm
			, DATE_FORMAT(b.LAST_UPDT_PNTTM, '%Y.%m.%d %H:%i:%S') AS lastUpdusrPnttm
			, b.RDCNT AS inqireCo
			, b.BBS_ID AS bbsId
			, IFNULL(b.NTT_ID, 0) AS nttId
			, s.BBS_TY_CODE AS bbsTyCode
			, s.REPLY_POSBL_AT AS replyPosblAt
			, s.FILE_ATCH_POSBL_AT AS fileAtchPosblAt
			, s.ATCH_POSBL_FILE_NUMBER AS posblAtchFileNumber
			, s.BBS_NM AS bbsNm  
		FROM
			COMTNBBS b
		LEFT OUTER JOIN 
			COMTNBBSMASTER s
		ON b.BBS_ID = s.BBS_ID
		WHERE b.BBS_ID = #{bbsId}	
			AND b.USE_AT = 'Y'
		ORDER BY nttId
		LIMIT 1
	</select>
 	
	<insert id="insertTRM" parameterType="adminBoardVO">
		<selectKey keyProperty="parnts" resultType="String" order="BEFORE">
			SELECT IFNULL(MIN(NTT_ID), 1) AS parnts  FROM COMTNBBS
			WHERE BBS_ID = #{bbsId}
		</selectKey>
		INSERT INTO COMTNBBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, RDCNT, PARNTSCTT_NO, NTT_NO, 
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, CUSTOM1
			</if>
			)
		VALUES
		(
			#{nttId}, #{bbsId}, #{nttSj}, #{nttCn}, #{nttId}, 
			#{ntcrId}, #{ntcrNm}, 0, #{parnts}, #{nttNo}, 
			#{frstRegisterId}, SYSDATE(), #{useAt}
			<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
				, #{custom1}
			</if>
			)
	</insert>
	
	<select id="selectTRMChildList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_NO AS nttNo
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(a.NTCR_NM, '') AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.LAST_UPDUSR_ID AS lastUpdusrId
			, DATE_FORMAT(a.LAST_UPDT_PNTTM, '%Y.%m.%d') AS lastUpdusrPnttm
			, a.PARNTSCTT_NO AS parnts
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.BBS_ID AS bbsId
			, a.CUSTOM1 AS custom1
		FROM
			COMTNBBS a
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
			AND a.PARNTSCTT_NO = #{parnts}
		ORDER BY a.ntt_no ASC
	</select>
	
 	<update id="updateTRM" parameterType="adminBoardVO">
		UPDATE COMTNBBS SET 
			NTT_SJ = #{nttSj}
			, LAST_UPDUSR_ID = #{lastUpdusrId}
			, ATCH_FILE_ID = #{atchFileId}
			, LAST_UPDT_PNTTM = SYSDATE()
			, USE_AT = #{useAt}
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			, CUSTOM1 = #{custom1}
		</if>
		WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<select id="selectCSTList" parameterType="adminBoardVO" resultType="adminBoardVO">
		SELECT
			a.NTT_ID AS nttId
			, a.NTT_SJ AS nttSj
			, a.NTT_CN AS nttCn
			, a.FRST_REGISTER_ID AS frstRegisterId
			, IFNULL(b.USER_NM, a.NTCR_NM) AS frstRegisterNm
			, DATE_FORMAT(a.FRST_REGIST_PNTTM, '%Y.%m.%d') AS frstRegisterPnttm
			, a.RDCNT AS inqireCo
			, a.PARNTSCTT_NO AS parnts
			, a.ANSWER_AT AS replyAt
			, a.ANSWER_LC AS replyLc
			, IFNULL(a.USE_AT, 'N') AS useAt
			, a.ATCH_FILE_ID AS atchFileId
			, a.BBS_ID AS bbsId
			, a.NTCE_BGNDE AS ntceBgnde
			, a.NTCE_ENDDE AS ntceEndde
			, a.SJ_BOLD_AT AS sjBoldAt
			, IFNULL(a.NOTICE_AT, 'N') AS noticeAt
			, a.SECRET_AT AS secretAt
			, c.COMMENT_CO AS commentCo
			, IFNULL(a.POSTING_YN, 'N') AS postingYn 
			, a.CUSTOM1 AS custom1
			, a.CUSTOM2 AS custom2
			, a.CUSTOM3 AS custom3
			, a.CUSTOM4 AS custom4
			, a.CUSTOM5 AS custom5
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE1, '%Y.%m.%d'), '') AS customDate1
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE2, '%Y.%m.%d'), '') AS customDate2
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE3, '%Y.%m.%d'), '') AS customDate3
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE4, '%Y.%m.%d'), '') AS customDate4
			, IFNULL(DATE_FORMAT(a.CUSTOM_DATE5, '%Y.%m.%d'), '') AS customDate5
			, (
				SELECT COUNT(*) FROM COMTNBBS
				WHERE PARNTSCTT_NO = a.NTT_ID
			) AS appCnt 
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		LEFT OUTER JOIN
			(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
			   FROM COMTNCOMMENT 
			 WHERE USE_AT = 'Y' 
			 GROUP BY NTT_ID, BBS_ID) c
		ON (a.NTT_ID = c.NTT_ID
			AND a.BBS_ID = c.BBS_ID
		)
		WHERE
			a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
			AND a.FRST_REGISTER_ID = #{frstRegisterId}
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		ORDER BY a.FRST_REGIST_PNTTM DESC, a.SORT_ORDR DESC, a.NTT_NO ASC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectCSTListCnt" parameterType="adminBoardVO" resultType="java.lang.Integer">
		SELECT
			COUNT(a.NTT_ID)
		FROM
			COMTNBBS a
		LEFT OUTER JOIN 
			COMVNUSERMASTER b
		ON a.FRST_REGISTER_ID = b.ESNTL_ID 
		WHERE a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
			AND a.FRST_REGISTER_ID = #{frstRegisterId}
		<if test="searchCnd == 0">
			AND
				a.NTT_SJ LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>
		<if test="searchCnd == 1">
			AND
				a.NTT_CN LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>	
		<if test="searchCnd == 2">
			AND
				b.USER_NM LIKE CONCAT ('%', #{searchWrd},'%') 		
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(postingYn)">
			AND IFNULL(a.POSTING_YN, 'N') = #{postingYn}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(ntcrNm)">
			AND a.NTCR_NM LIKE CONCAT ('%', #{ntcrNm},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom1)">
			AND a.CUSTOM1 = #{custom1}
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(custom2)">
			AND a.CUSTOM2 LIKE CONCAT ('%', #{custom2},'%')
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(bbsId, 'BBSMSTR_000000000015')">
			AND a.PARNTSCTT_NO = 0
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'Y')">
			AND a.NTT_ID in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isEquals(replyAt, 'N')">
			AND a.NTT_ID not in (
				SELECT PARNTSCTT_NO FROM COMTNBBS WHERE PARNTSCTT_NO != 0
			)
		</if>
	</select>
 	
</mapper>